<!DOCTYPE html>
<html lang="en">
  <head>
  	<title>Sheep! - viewer</title>
    <meta charset="utf-8" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> 
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@100;300;400;700&display=swap" rel="stylesheet"> 

		<style>
			body{
				font-family: Quicksand,sans-serif;
				margin: 20px;
				color: #eee;
				background-color: #118102;
			}
			
			span{
				display:inline-block;
				width:100px;
				margin:10px;
			}
			#overall{
				display:block;
				position:absolute;
				top:0;
				right:0;
				padding-bottom: 200px;

			}

			#cen{
				position: fixed;
				width: 100%;

			}
			#sheepContainer{
				margin: auto;
				width: 400px;
				text-align: center;


			}
			@media (max-width: 1150px){
				#sheepContainer{
					margin: 0;
				}
			}
			#overall div{
				margin:0;
				padding:0;
			}
			#op{
				width:200px;
			}
			.asset{
				font-weight: 100;
				font-size: 20px;
				text-align: center;
				padding-top: 40px;
				border-bottom: solid 1px;
			}
			

			
			#wrap{
				position:fixed;
				width:100%;
			}
			#sheep img{
				width: 300px;
				border: solid #222 10px;
				border-radius: 10px;
			}
			#arrows{
				text-align: center;
				width: 100%;
			}
			.arrow{
				display: inline-block;
				margin: 10px;
			}
			.arrow img{
				width: 50px;
				cursor: pointer;
			}
			#sheepnum{
				margin: auto;
				width: 100px;
				display: inline-block;
				background-color: #ff9933;
				background-color: transparent;
				border: 0;
				border: solid #ff9933 2px;
				-webkit-appearance: none;
				padding: 5px;
				text-align: right;
				color: #fff;
				font-weight: bold;
				margin-left: 10px;
			}
			#searcharea{
				width: 300px;
				margin: auto;
				text-align: center;
			}

			#stats{
				margin: auto;
				width: 100%;
				font-size: 12px;
				
			}
			table#currentStats{
				margin:auto;
				margin-top: 20px;
				width: 100%;	
				background-color: red;

			}
			tr, td,th{
				
				padding:  2px 5px;
				text-align: left;
			}

			tr{
				width: 100%;
				
			}
	

			.type{	
					text-align: right;
					width: 56%;
			}
			.option{
				color: #edb118;
				font-weight: bold;
				width: 45%;
			}
			.rarity{
				width: 5%;
			}
			#tabletop th{
				border-bottom: solid 1px;

			}

/*
			#fence{
				width: 100%;
				height: 200px;
				position: fixed;
				bottom: 0;
				left: 0;
				background: url('fence.png') repeat-x;
			}
		*/
		</style>
	</head>
	<body>
		<div id='cen'>
			<div id='sheepContainer'>
					

						<div id='sheep'>
							<img src='../smolnft/sheep0000.jpg' />
						
						</div>

						<div id='arrows'>
							<div id='prev' class='arrow'> <img src='../images/backArrow.png' alt = '<<<' /> </div>
							<div id='next' class='arrow'> <img src='../images/nextArrow.png' alt = '>>>' /> </div>
					</div>
					<div id='searcharea'>
						<input type='text' id='sheepnum' name='sheepnum' />
					</div>
					<div id='stats'>

					</div>
			</div>
		</div>
		<table id='overall'></table>
		<div id='fence'></div>
		
		<script>

			var smolManifest = "KSM69nl1E_NcjWx7R_t_I1zCBUPwg-5BQkuBxvFu83s";
			var stats = [];
			var totalNFT = 4242;
			var num = 0;
			var metaData;
//LOADER----
			$.getJSON("../asset-data/metaDataComplete.json", function(data){
				metaData = data;

			}).done(function(){
				num = num.replace(/\D/, '');

				if(parseInt(num)<0){
					num = 0;
					
				}else if(parseInt(num) >= totalNFT) {
					num = totalNFT-1;
				}

				$('#sheepnum').val(num);
				num = pad(num,4);
				update(num);
			});

			$.getJSON("../asset-data/_counterStats.json", function(data){

				$.each( data, function( key, val ) {
					stats[key] = [];
					$('#overall').append("<tr><th class='asset' colspan='2'>" + key + "</th></tr>");
					$.each( data[key], function( k, v ) {
						stats[key][k] = v
						var rarity = Math.floor(parseInt(v) / totalNFT * 1000)/10;
						$('#overall').append("<tr class='stat'><td class='type'>" + k + "</td><td class='option'>" + rarity + "%</td></tr>");
					});
				});

			}).done(function(){
					 num = $('#sheepnum').val();
					num = num.replace(/\D/, '');

					if(parseInt(num)<0){
						num = 0;
						
					}else if(parseInt(num) >= totalNFT) {
						num = totalNFT-1;
					}

					$('#sheepnum').val(num);
					num = pad(num,4);
					update(num);
			});
			
			$('#next').click(function(){
				num = parseInt(num) +  1;
				if(num==totalNFT) num = 0;

				$('#sheepnum').val(num);

				num = pad(num,4);
				
				update(num);
				

			});

			$('#prev').click(function(){
				num = parseInt(num) -  1;
				if(num<0) num = totalNFT-1;

				$('#sheepnum').val(num);

				num = pad(num,4);
				
				update(num);

			});

			$('#submit').click(function(){
				num = $('#sheepnum').val();
				update(num);
			});



			$('#sheepnum').on('input',function(){
				num = $('#sheepnum').val();
				num = num.replace(/\D/, '');

				if(parseInt(num)<0){
					num = 0;
					
				}else if(parseInt(num) >= totalNFT) {
					num = totalNFT-1;
				}

				$('#sheepnum').val(num);
				num = pad(num,4);
				update(num);
			});



			function pad(num, size) {
				num = num.toString();
				while (num.length < size) num = "0" + num;
				return num;
			}

			function update(num){
				$('#stats').html('');
				
				//$('#sheep img').attr('src','nft/sheep' + num + '.png');
				$('#sheep img').attr('src',"https://arweave.net/" + smolManifest + "/sheep" + num + '.jpg');

				var items = metaData["sheep" + num];
					console.log(items);
					  $('#stats').append("<table id='currentStats'>");
					  $('#stats').append("<tr id='tabletop'><th class='type'>attribute</th><th class='option'>option</th><th class='rarity'>rarity</th></tr>");
					  $.each( items, function( key, val ) {
					  	$.each( val, function( k, v ) {
								$('#stats').append("<tr class='stat'>");
								$('#stats').append("<td class='type'>" + key + "</td>");
								$('#stats').append("<td class='option'>" + v + "</td>");
								var rarity = Math.floor(parseInt(stats[key][v]) / totalNFT * 1000)/10;
								$('#stats').append("<td class='rarity'>" + rarity + "%</td></tr>");
							});
						});
						$('#stats').append("</table>");	

				/*
				$.getJSON( "../completedMetadata/sheep" + num + ".json", function( data ) {
					  var items = data['attributes'];
					  $('#stats').append("<table id='currentStats'>");
					  $('#stats').append("<tr id='tabletop'><th class='type'>attribute</th><th class='option'>option</th><th class='rarity'>rarity</th></tr>");
					  $.each( items, function( key, val ) {
							$('#stats').append("<tr class='stat'>");
							$('#stats').append("<td class='type'>" + val['trait_type'] + "</td>");
							$('#stats').append("<td class='option'>" + val['value'] + "</td>");
							var rarity = Math.floor(parseInt(stats[val['trait_type']][val['value']]) / totalNFT * 1000)/10;
							$('#stats').append("<td class='rarity'>" + rarity + "%</td></tr>");

						});
						$('#stats').append("</table>");	
				});
				*/
			}


			function getNumFromBox(inc){
				num = $('#sheepnum').val();
				num = num.replace(/\D/, '');

				num = parseInt(num) + inc;
				
				if(parseInt(num)<0){
					num = 0;
					
				}else if(parseInt(num) >= totalNFT) {
					num = totalNFT-1;
				}

				$('#sheepnum').val(num);
				num = pad(num,4);
				return num;
			}


			$(document).keydown(function(e){
				if (e.which == 37)
					update(getNumFromBox(-1));
				else if (e.which == 39)
					update(getNumFromBox(1));
			})
		</script>
	</body>
</html>
